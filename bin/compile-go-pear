#!/bin/bash
set -o xtrace
set -o errexit
source $(dirname $0)/compile-extensions-common

travis_time_start

pushd /tmp
if [ -n $GITHUB_TOKEN ]; then
	auth_flag="-H 'Authorization: token $GITHUB_TOKEN'"
fi

tarball_url=$(curl -sSfL "${auth_flag}" https://api.github.com/repos/pear/pear-core/releases/latest | jq -r .tarball_url)

if [ -z $tarball_url ]; then
	echo "Latest PEAR tarball not found"
	exit 1
fi

curl -sSfL -o pear.tar.gz $tarball_url
tar xvf pear.tar.gz
pushd pear-pear-core-*
./build-release.sh

test -f go-pear.phar && mv go-pear.phar $TRAVIS_BUILD_DIR

popd
popd

travis_time_finish
